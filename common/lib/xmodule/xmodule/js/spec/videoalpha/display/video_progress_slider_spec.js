// Generated by CoffeeScript 1.6.3
(function() {
  xdescribe('VideoProgressSliderAlpha', function() {
    beforeEach(function() {
      return window.onTouchBasedDevice = jasmine.createSpy('onTouchBasedDevice').andReturn(false);
    });
    describe('constructor', function() {
      describe('on a non-touch based device', function() {
        beforeEach(function() {
          spyOn($.fn, 'slider').andCallThrough();
          this.player = jasmine.stubVideoPlayerAlpha(this);
          return this.progressSlider = this.player.progressSlider;
        });
        it('build the slider', function() {
          expect(this.progressSlider.slider).toBe('.slider');
          return expect($.fn.slider).toHaveBeenCalledWith({
            range: 'min',
            change: this.progressSlider.onChange,
            slide: this.progressSlider.onSlide,
            stop: this.progressSlider.onStop
          });
        });
        return it('build the seek handle', function() {
          expect(this.progressSlider.handle).toBe('.slider .ui-slider-handle');
          return expect($.fn.qtip).toHaveBeenCalledWith({
            content: "0:00",
            position: {
              my: 'bottom center',
              at: 'top center',
              container: this.progressSlider.handle
            },
            hide: {
              delay: 700
            },
            style: {
              classes: 'ui-tooltip-slider',
              widget: true
            }
          });
        });
      });
      return describe('on a touch-based device', function() {
        beforeEach(function() {
          window.onTouchBasedDevice.andReturn(true);
          spyOn($.fn, 'slider').andCallThrough();
          this.player = jasmine.stubVideoPlayerAlpha(this);
          return this.progressSlider = this.player.progressSlider;
        });
        return it('does not build the slider', function() {
          expect(this.progressSlider.slider).toBeUndefined;
          return expect($.fn.slider).not.toHaveBeenCalled();
        });
      });
    });
    describe('play', function() {
      beforeEach(function() {
        spyOn(VideoProgressSliderAlpha.prototype, 'buildSlider').andCallThrough();
        this.player = jasmine.stubVideoPlayerAlpha(this);
        return this.progressSlider = this.player.progressSlider;
      });
      describe('when the slider was already built', function() {
        beforeEach(function() {
          return this.progressSlider.play();
        });
        return it('does not build the slider', function() {
          return expect(this.progressSlider.buildSlider.calls.length).toEqual(1);
        });
      });
      return describe('when the slider was not already built', function() {
        beforeEach(function() {
          spyOn($.fn, 'slider').andCallThrough();
          this.progressSlider.slider = null;
          return this.progressSlider.play();
        });
        it('build the slider', function() {
          expect(this.progressSlider.slider).toBe('.slider');
          return expect($.fn.slider).toHaveBeenCalledWith({
            range: 'min',
            change: this.progressSlider.onChange,
            slide: this.progressSlider.onSlide,
            stop: this.progressSlider.onStop
          });
        });
        return it('build the seek handle', function() {
          expect(this.progressSlider.handle).toBe('.ui-slider-handle');
          return expect($.fn.qtip).toHaveBeenCalledWith({
            content: "0:00",
            position: {
              my: 'bottom center',
              at: 'top center',
              container: this.progressSlider.handle
            },
            hide: {
              delay: 700
            },
            style: {
              classes: 'ui-tooltip-slider',
              widget: true
            }
          });
        });
      });
    });
    describe('updatePlayTime', function() {
      beforeEach(function() {
        this.player = jasmine.stubVideoPlayerAlpha(this);
        return this.progressSlider = this.player.progressSlider;
      });
      describe('when frozen', function() {
        beforeEach(function() {
          spyOn($.fn, 'slider').andCallThrough();
          this.progressSlider.frozen = true;
          return this.progressSlider.updatePlayTime(20, 120);
        });
        return it('does not update the slider', function() {
          return expect($.fn.slider).not.toHaveBeenCalled();
        });
      });
      return describe('when not frozen', function() {
        beforeEach(function() {
          spyOn($.fn, 'slider').andCallThrough();
          this.progressSlider.frozen = false;
          return this.progressSlider.updatePlayTime(20, 120);
        });
        it('update the max value of the slider', function() {
          return expect($.fn.slider).toHaveBeenCalledWith('option', 'max', 120);
        });
        return it('update current value of the slider', function() {
          return expect($.fn.slider).toHaveBeenCalledWith('value', 20);
        });
      });
    });
    describe('onSlide', function() {
      beforeEach(function() {
        this.player = jasmine.stubVideoPlayerAlpha(this);
        this.progressSlider = this.player.progressSlider;
        spyOnEvent(this.progressSlider, 'slide_seek');
        return this.progressSlider.onSlide({}, {
          value: 20
        });
      });
      it('freeze the slider', function() {
        return expect(this.progressSlider.frozen).toBeTruthy();
      });
      it('update the tooltip', function() {
        return expect($.fn.qtip).toHaveBeenCalled();
      });
      return it('trigger seek event', function() {
        expect('slide_seek').toHaveBeenTriggeredOn(this.progressSlider);
        return expect(this.player.currentTime).toEqual(20);
      });
    });
    describe('onChange', function() {
      beforeEach(function() {
        this.player = jasmine.stubVideoPlayerAlpha(this);
        this.progressSlider = this.player.progressSlider;
        return this.progressSlider.onChange({}, {
          value: 20
        });
      });
      return it('update the tooltip', function() {
        return expect($.fn.qtip).toHaveBeenCalled();
      });
    });
    describe('onStop', function() {
      beforeEach(function() {
        this.player = jasmine.stubVideoPlayerAlpha(this);
        this.progressSlider = this.player.progressSlider;
        spyOnEvent(this.progressSlider, 'slide_seek');
        return this.progressSlider.onStop({}, {
          value: 20
        });
      });
      it('freeze the slider', function() {
        return expect(this.progressSlider.frozen).toBeTruthy();
      });
      it('trigger seek event', function() {
        expect('slide_seek').toHaveBeenTriggeredOn(this.progressSlider);
        return expect(this.player.currentTime).toEqual(20);
      });
      return it('set timeout to unfreeze the slider', function() {
        expect(window.setTimeout).toHaveBeenCalledWith(jasmine.any(Function), 200);
        window.setTimeout.mostRecentCall.args[0]();
        return expect(this.progressSlider.frozen).toBeFalsy();
      });
    });
    return describe('updateTooltip', function() {
      beforeEach(function() {
        this.player = jasmine.stubVideoPlayerAlpha(this);
        this.progressSlider = this.player.progressSlider;
        return this.progressSlider.updateTooltip(90);
      });
      return it('set the tooltip value', function() {
        return expect($.fn.qtip).toHaveBeenCalledWith('option', 'content.text', '1:30');
      });
    });
  });

}).call(this);
